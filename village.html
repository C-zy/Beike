<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>找小区</title>
    <link rel="icon" href="img/logo.ico" type="images/x-ico" />
    <link rel="stylesheet" href="css/mui.min.css">
    <link rel="stylesheet" href="css/village.css">
    <link rel="stylesheet" href="fonts/fonts_village/iconfont.css">
    <script src="js/zepto.js"></script>
    <script src="js/mui.min.js"></script>
</head>

<body>
    <!-- 头部 -->
    <div class="header all">
        <span class="iconfont icon-zuojiantou jt" id="home"></span>
        <div class="logo">
            <a href="city.html" class="header_city" id="city">北京
                <span class="iconfont icon-xiajiantou jt_s"></span>
            </a>
            <img src="img/img_village/0.png" alt="">
            <span class="iconfont icon-user"></span>
        </div>
    </div>
    <!-- 搜索框 -->
    <div class="search all all_pd">
        <a href="">
            <span class="iconfont icon-search"></span>
            <input type="text" placeholder="请输入小区或商圈名~">
        </a>
    </div>
    <!-- 类型选择 -->
    <ul class="option all all_pd option_flexd">
        <li class="tab_option">区域<span class="sjx"></span></li>
        <li class="tab_option">均价<span class="sjx"></span></li>
        <li class="tab_option">类型<span class="sjx"></span></li>
        <li class="tab_option">楼龄<span class="sjx"></span></li>
    </ul>
    <!-- 隐藏的类型 -->
    <div class="hide_option">
        <ul class="option all all_pd">
            <li class="tab_option_1 active">区域<span class="sjx"></span></li>
            <li class="tab_option_1">均价<span class="sjx"></span></li>
            <li class="tab_option_1">类型<span class="sjx"></span></li>
            <li class="tab_option_1">楼龄<span class="sjx"></span></li>
        </ul>
        <div class="_city hide_div">
            <div class="left">
                <p class="list_change">区域</p>
            </div>
            <div class="center">
                <p class="list_change city_1 active">不限</p>
                <p class="list_change city_1">二七</p>
                <p class="list_change city_1">郑东新区</p>
                <p class="list_change city_1">荥阳市</p>
                <p class="list_change city_1">新郑市</p>
                <p class="list_change city_1">上街区</p>
                <p class="list_change city_1">巩义市</p>
                <p class="list_change city_1">新密市</p>
                <p class="list_change city_1">登封市</p>
                <p class="list_change city_1">中牟县</p>
                <p class="list_change city_1">经发区</p>
            </div>
            <div class="right add_city_right">
                <p class="list_change city_2 city_2_default active">不限</p>
            </div>
        </div>
        <div class="_price hide_div">
            <p class="list_change" data-value="均价">不限</p>
            <p class="list_change" data-value="2万以下">2万以下</p>
            <p class="list_change" data-value="2-3万">2-3万</p>
            <p class="list_change" data-value="3-4万">3-4万</p>
            <p class="list_change" data-value="4-5万">4-5万</p>
            <p class="list_change" data-value="5-6万">5-6万</p>
            <p class="list_change" data-value="6万以上">6万以上</p>
            <p class="list_change" data-value="其他">自定义价格
                <span> <input type="text"> - <input type="text"> <button>确定</button></span>
            </p>
        </div>
        <div class="_type hide_div">
            <p class="list_change">塔楼
                <span class="checkbox"></span>
            </p>
            <p class="list_change">板楼
                <span class="checkbox"></span>
            </p>
            <p class="list_change">板塔结合
                <span class="checkbox"></span>
            </p>
            <p class="list_change">其他
                <span class="checkbox"></span>
            </p>
            <button class="true">确定</button>
        </div>
        <div class="_age hide_div">
            <p class="list_change">5年以内
                <span class="checkbox"></span>
            </p>
            <p class="list_change">10年以内
                <span class="checkbox"></span>
            </p>
            <p class="list_change">15年以内
                <span class="checkbox"></span>
            </p>
            <p class="list_change">20年以内
                <span class="checkbox"></span>
            </p>
            <p class="list_change">20年以上
                <span class="checkbox"></span>
            </p>
            <button class="true">确定</button>
        </div>
    </div>
    <!-- 小区列表 -->
    <ul class="lists_add all all_pd" style="background-color: #fff;">

    </ul>
    <!-- 圆圈 -->
    <button type="button" class="mui-btn btn_1 iconfont icon-cebianlan-shunxuqiehuan"><br>排序</button>
    <a href=""><button type="button" class="mui-btn btn_2 iconfont icon-xiaoxi"></button></a>
    <!-- 排序 -->
    <div class="sort">
        <div class="sort_inner">
            <p class="sort_1">默认排序</p>
            <p class="sort_2">均价从低到高</p>
            <p class="sort_3">均价从高到低</p>
        </div>

    </div>
    <!-- 底部 -->
    <div class="kem__footer">
        <div class="footer-breadcrumb">
            贝壳找房郑州站
            <span>|</span> 营业执照
            <span>|</span> ICP证
        </div>
        <div class="footer-nav">
            <div class="link-tit">
                <h3 class="tit active" id="ho_tp">二手房</h3>
                <h3 class="tit " id="ho_tpl">小区</h3>
            </div>
            <div class="link-cont">
                <ul class="cont co1">
                    <li><a href="#">北京二手房</a></li>
                    <li><a href="#">上海二手房</a></li>
                    <li><a href="#">广州二手房</a></li>
                    <li><a href="#">深圳二手房</a></li>
                    <li><a href="#">天津二手房</a></li>
                    <li><a href="#">成都二手房</a></li>
                    <li><a href="#">南京二手房</a></li>
                    <li><a href="#">杭州二手房</a></li>
                    <li><a href="#">青岛二手房</a></li>
                    <li><a href="#">大连二手房</a></li>
                    <li><a href="#">苏州二手房</a></li>
                    <li><a href="#">厦门二手房</a></li>
                </ul>
                <ul class="cont co2">
                    <li><a href="#">北京小区</a></li>
                    <li><a href="#">上海小区</a></li>
                    <li><a href="#">广州小区</a></li>
                    <li><a href="#">深圳小区</a></li>
                    <li><a href="#">天津小区</a></li>
                    <li><a href="#">成都小区</a></li>
                    <li><a href="#">南京小区</a></li>
                    <li><a href="#">杭州小区</a></li>
                    <li><a href="#">青岛小区</a></li>
                    <li><a href="#">大连小区</a></li>
                    <li><a href="#">苏州小区</a></li>
                    <li><a href="#">厦门小区</a></li>
                </ul>
            </div>
        </div>
        <div class="bottom-info ke">
            <div class="icon-box">
                <span class="icon-iphone ">iPhone客户端</span>
                <span class="icon-android ">Android客户端</span>
            </div>
            <div class="copyright">
                <p class="company">天津小屋信息科技有限公司</p>
                <p class="record">C座一层112室09单元</p>
                <p class="record">电话:111111111</p>
                <p class="record">网络经营许可证</p>
                <p class="record">津ICP备18000836号</p>
                <p class="record">网络文化经营许可证 津网文（2017）2063-011号</p>
                <p class="record">ICP经营许可证 津B2-20170026</p>
                <p class="record">copyright©</p>
                <p class="record">
                    <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12019002000223"><img src="img/foot/f2.png" alt=""> 津公网安备 12019002000223号</a>
                </p>
            </div>
        </div>
    </div>
    </div>
    <div class="alert" style="width: 2rem;background-color: rgba(0, 0, 0, 0.5);height: 1rem; position: fixed; top: 50%;line-height: 1rem;text-align: center;left: 50%;color: #fff;transform: translateX(-50%);font-size: .4rem;display: none;">
        加载中...
    </div>
</body>
<script>
    function fn() {
        var all = document.documentElement;
        var all_width = all.getBoundingClientRect().width;
        rem = all_width / 7.5
        all.style.fontSize = rem + 'px'
    }
    fn();
    window.addEventListener("resize", function() {
        fn()
    }, false)

    //类型选择tab切换
    $('.tab_option').on('click', function() {
        $('.hide_option').show()
        num = $(this).index()
        $('.tab_option_1').eq(num).addClass('active').siblings().removeClass('active')
        $('.hide_div').eq(num).show().siblings('.hide_div').hide()
    })
    $('.tab_option_1').on('click', function(e) {
        num = $(this).index()
        $(this).addClass('active').siblings().removeClass('active')
        e.stopPropagation()
        $('.hide_div').eq(num).show().siblings('.hide_div').hide()
    })
    $('.hide_option').click(() => {
        $('.hide_option').hide()
    })
    $('.hide_div').click((e) => {
            e.stopPropagation()
        })
        //区域点击
    var city_arr = [
        ['不限'],
        ['不限', '碧沙岗', '常西湖', '电力新村', '帝湖', '古玩城', '火车站', '老航院', '河医立交桥 '],
        ['不限', '白沙', '北大学城', '北站', 'CBD', '第八大街', '黄河南路'],
        ['不限', '常西湖', '巩义市', '邙山', '万客来', '荥阳', '新密市'],
        ['不限', '管南区域', '航空港商圈', '航空港商圈', '南龙湖商圈'],
        ['不限', '上街区'],
        ['不限', '巩义市'],
        ['不限', '登封市', '南龙湖商圈', '万客来', '荥阳', '新密市', '新郑市'],
        ['不限', '登封市', '巩义市'],
        ['不限', '白沙', '第八大街', '管南区域', '航空港商圈'],
        ['不限', '白沙', '第八大街', '第三大街', '航空港商圈', '黄河南路', '世纪欢乐园']
    ]
    $('._city .city_1').on('click', function() {
        $(this).addClass('active').siblings('.city_1').removeClass('active')
        $('.add_city_right').get(0).innerHTML = ''
        for (var i = 0; i < city_arr[$(this).index()].length; i++) {
            $('.add_city_right').get(0).innerHTML += `
                <p class="list_change city_2">${city_arr[$(this).index()][i]}</p>
                `
        }
        if ($('.add_city_right .active').length == 0) {
            $('.add_city_right .city_2').eq(0).addClass('active')
        }
        $('.city_2').on('click', function() {
            $(this).addClass('active').siblings('.city_2').removeClass('active')
            if ($(this).text() == '不限') {
                $('.tab_option').eq(0).html('区域' + `<span class="sjx"></span>`).removeClass('active')
            } else {
                $('.tab_option').eq(0).html($(this).text() + `<span class="sjx"></span>`).addClass('active')
            }
            $('.hide_option').hide()
        })
    })
    $('.city_2_default').on('click', function() {
        $('.hide_option').hide()
    })

    //均价点击
    $('._price .list_change').on('click', function() {
            $(this).addClass('active_color').siblings('._price .list_change').removeClass('active_color')
            $('.tab_option').eq(1).html(this.dataset['value'] + `<span class="sjx"></span>`).addClass('active')
            if (this.dataset['value'] == '均价') {
                $('.tab_option').eq(1).removeClass('active')
            }
            $('.hide_option').hide()
        })
        //类型点击
    $('._type .list_change').on('click', function() {
        $(this).toggleClass('active')
        $('._type .checkbox').eq($(this).index()).html(`
                <span class="mui-icon mui-icon-checkmarkempty true"></span>
                `)
    })
    $('._type .true').on('click', function() {
            if ($('._type .active').length == 0) {
                $('.tab_option').eq(2).html('均价' + `<span class="sjx"></span>`).removeClass('active')
            } else if ($('._type .active').length == 1) {
                if ($('._type .active').text().length > 66) {
                    var _type = $('._type .active').text().slice(0, 3) + '...'
                } else {
                    var _type = $('._type .active').text()
                }
                $('.tab_option').eq(2).html(_type + `<span class="sjx"></span>`).addClass('active')
            } else {
                $('.tab_option').eq(2).html('多选' + `<span class="sjx"></span>`).addClass('active')
            }
            $('.hide_option').hide()
        })
        //楼龄点击
    $('._age .list_change').on('click', function() {
        $(this).toggleClass('active')
        $('._age .checkbox').eq($(this).index()).html(`
                <span class="mui-icon mui-icon-checkmarkempty true"></span>
                `)
    })
    $('._age .true').on('click', function() {
            if ($('._age .active').length == 0) {
                $('.tab_option').eq(3).html('均价' + `<span class="sjx"></span>`).removeClass('active')
            } else if ($('._age .active').length == 1) {
                if ($('._age .active').text().length > 68) {
                    var _age = $('._age .active').text().slice(0, 3) + '...'
                } else {
                    var _age = $('._age .active').text()
                }
                $('.tab_option').eq(3).html(_age + `<span class="sjx"></span>`).addClass('active')
            } else {
                $('.tab_option').eq(3).html('多选' + `<span class="sjx"></span>`).addClass('active')
            }
            $('.hide_option').hide()
        })
        // 底部tap切换
    $("#ho_tp").click(() => {
        if ($("#ho_tp").hasClass("active")) {

        } else {
            $(".co1").show()
            $(".co2").hide()
            $("#ho_tp").addClass("active")
            $("#ho_tpl").removeClass("active")
        }
    })
    $("#ho_tpl").click(() => {
        if ($("#ho_tpl").hasClass("active")) {

        } else {
            $(".co2").show()
            $(".co1").hide()
            $("#ho_tp").removeClass("active")
            $("#ho_tpl").addClass("active")
        }
    })
    $('.btn_1').click(() => {
        $('.sort').show()
    })
    $('.sort').click(() => {
        $('.sort').hide()
    })

    var a = 0
    window.onload = function() {
        add(a)
    }

    function add(i) {
        $('.alert').show()
        if (i < 4) {
            $.getJSON('http://localhost:3000/village?num=' + i, function(data) {
                for (var i = 0; i < data.length; i++) {
                    $('.lists_add').get(0).innerHTML += `
                            <a href="#"><li class="list clear">
                                <div class="img _fl">
                                    <img src="${data[i].img}" alt="">
                                    <p class="blue_bg">小区攻略</p>
                                </div>
                                <div class="right _fl">
                                    <p class="name">${data[i].name}</p>
                                    <p class="present">${data[i].present}</p>
                                    <p class="price">${data[i].price}</p>
                                </div>
                            </li></a>
                        `
                }
                setTimeout(() => {
                    $('.alert').hide()
                }, 300);
            })
        } else {
            $('.alert').text('到底了...')
            setTimeout(() => {
                $('.alert').hide()
            }, 300);
        }

    }
    setTimeout(() => {
        window.onscroll = function() {
            if ($(this).scrollTop() > $('.kem__footer').offset().top - $('.kem__footer').height()) {
                a++
                add(a)
            }

        }
    }, 1000);
    var num_scroll = $(".option").offset().top
    window.addEventListener("scroll", function() {
            if ($(this).scrollTop() > num_scroll) {
                $('.option_flexd').addClass('flexd')
            } else if ($(this).scrollTop() < num_scroll) {
                $('.option_flexd').removeClass('flexd')
            }
        })
        // 用户本地存储
    // var na = decodeURI(window.location.search.split("=")[1]);
    // if (na == "undefined") {

    // } else {
    //     sessionStorage.name = na;
    // }
    // 城市改变
    $("#city").click(() => {
        window.location.href = "city.html"
    })
    if (sessionStorage.city) {
        $("#city").html(sessionStorage.city + `<span class="iconfont icon-xiajiantou jt_s"></span>`)
    } else {
        $("#city").html(`郑州<span class="iconfont icon-xiajiantou jt_s"></span>`)
    }
    $("#home").click(()=>{
        window.location.href="index.html"
    })
</script>

</html>