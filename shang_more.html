<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>贝壳商业</title>
    <link rel="icon" href="img/logo.ico" type="images/x-ico" />
    <link rel="stylesheet" href="css/mui.min.css">
    <link rel="stylesheet" href="css/shang_more.css">
    <link rel="stylesheet" href="fonts/fonts_village/iconfont.css">
    <script src="js/zepto.js"></script>
    <script src="js/mui.min.js"></script>
</head>

<body>
    <!-- 头部 -->
    <a href="shang.html">
        <div class="header all">
            <span class="iconfont icon-zuojiantou jt"></span>
            <div class="logo">
                <img src="img/img_shang/0.png" alt="">
            </div>
        </div>
    </a>

    <div class="nav">
        <div class="search all all_pd">
            <a href="">
                <span class="iconfont icon-search"></span>
                <input type="text" placeholder="请输入小区或商圈名~">
            </a>
        </div>
        <!-- 类型选择 -->
        <ul class="option all all_pd option_flexd">
            <li class="tab_option tab_option_city"><span class="sjx"></span></li>
            <li class="tab_option">价格<span class="sjx"></span></li>
            <li class="tab_option">面积<span class="sjx"></span></li>
            <li class="tab_option">更多<span class="sjx"></span></li>
            <li class="tab_option"><span class="iconfont icon-cebianlan-shunxuqiehuan change_span"></li>
        </ul>
    </div>
    <div class="hide_option">
        <div class="child_hide">
            <!-- 头部 -->
            <div class="header all">
                <span class="iconfont icon-zuojiantou jt"></span>
                <div class="logo">
                    <img src="img/img_shang/0.png" alt="">
                </div>
    </div>
    <div class="search all all_pd">
        <a href="">
            <span class="iconfont icon-search"></span>
            <input type="text" placeholder="请输入小区或商圈名~">
        </a>
    </div>
    <!-- 类型选择 -->
    <ul class="option all all_pd option_flexd">
        <li class="tab_option tab_option_city"><span class="sjx"></span></li>
        <li class="tab_option">价格<span class="sjx"></span></li>
        <li class="tab_option">面积<span class="sjx"></span></li>
        <li class="tab_option">更多<span class="sjx"></span></li>
        <li class="tab_option"><span class="iconfont icon-cebianlan-shunxuqiehuan change_span"></li>
            </ul>
            <div class="_price hide_div">
                <div class="left">
                    <p class="list_change active _price_1">天单价</p>
                    <p class="list_change _price_1">月单价</p>
                    <p class="list_change _price_1">总价</p>
                </div>
                <div class="right">
                    <p class="list_change _price_2">不限
                        <span class="checkbox"></span>
            </p>
            <p class="list_change _price_2">3-5元/天/㎡
                <span class="checkbox"></span>
            </p>
            <p class="list_change _price_2">5-7元/天/㎡
                <span class="checkbox"></span>
            </p>
            <p class="list_change _price_2">7-9元/天/㎡
                <span class="checkbox"></span>
            </p>
            <p class="list_change _price_2">9-12元/天/㎡
                <span class="checkbox"></span>
            </p>
            </div>
            <div class="bottom">
                <button class="price_all">不限条件</button>
                <button class="price_true">确定</button>
            </div>
            </div>
            <div class="_type hide_div all_pd">
                <p class="list_change off_click">面积</p>
                <button class="list_change">不限</button>
                <button class="list_change">&lt; 20㎡</button>
                <button class="list_change">20-50㎡</button>
                <button class="list_change">20-50㎡</button>
                <button class="list_change">20-50㎡</button>
                <button class="list_change">20-50㎡</button>
                <button class="list_change">20-50㎡</button>
                <div class="bottom">
                    <button class="price_all">不限条件</button>
                    <button class="price_true">确定</button>
                </div>
            </div>
            <div class="_age hide_div all_pd">
                <div class="top">
                    <p class="list_change off_click">VR房源</p>
                    <button class="list_change">VR房源</button>
                    <p class="list_change off_click">优质房源</p>
                    <button class="list_change">优质</button>
                    <p class="list_change off_click">房间</p>
                    <button class="list_change">餐饮</button>
                    <button class="list_change">美容美发</button>
                    <button class="list_change">生活服务</button>
                    <button class="list_change">零售</button>
                    <button class="list_change">批发</button>
                    <button class="list_change">餐馆住宿</button>
                    <button class="list_change">其他</button>
                    <p class="list_change off_click">装修</p>
                    <button class="list_change">特定行业装修</button>
                    <button class="list_change">基本装修</button>
                    <button class="list_change">毛坯</button>
                    <p class="list_change off_click">楼层</p>
                    <button class="list_change">底层</button>
                    <button class="list_change">中层</button>
                    <button class="list_change">高层</button>
                </div>
                <div class="bottom">
                    <button class="price_all">不限条件</button>
                    <button class="price_true">确定</button>
                </div>
            </div>
            <div class="_change hide_div">
                <p class="list_change">默认排序</p>
                <p class="list_change">单价从低到高</p>
                <p class="list_change">单价从高到低</p>
                <p class="list_change">单价从高到低</p>
                <p class="list_change">总价从高到低</p>
                <p class="list_change">面积从大到小</p>
                <p class="list_change">面积从小到大</p>
            </div>
            </div>
            </div>
            <ul class="lists all_pd" id="list_add">

            </ul>
            <div class="alert" style="width: 2rem;background-color: rgba(0, 0, 0, 0.5);height: 1rem; position: fixed; top: 50%;line-height: 1rem;text-align: center;left: 50%;color: #fff;transform: translateX(-50%);font-size: .4rem;display: none;">
                加载中...
            </div>
</body>
<script>
    function fn() {
        var all = document.documentElement;
        var all_width = all.getBoundingClientRect().width;
        rem = all_width / 7.5;
        all.style.fontSize = rem + 'px';
    };
    fn();
    window.addEventListener("resize", function() {
        fn();
    }, false);

    $('.tab_option').on('click', function() {
        $('.hide_option').show();
        num = $(this).index();
        $('.hide_div').eq(num - 1).show().siblings('.hide_div').hide();
        $('.tab_option_city').removeClass('active');
    });
    $('.tab_option_city').off('click').click(() => {
        $('.tab_option_city').addClass('active');
        $('.hide_option').hide();
    });
    $('.hide_option').click(() => {
        $('.hide_option').hide();
    });
    $('.hide_div').click((e) => {
        e.stopPropagation();
    })
    $('.child_hide').click((e) => {
        e.stopPropagation();
    });

    var __price = [
        ['不限', '3-5元/天/㎡', '5-7元/天/㎡', '7-9元/天/㎡', '9-12元/天/㎡'],
        ['不限', '0-80元/月/㎡', '80-100元/月/㎡', '100-120元/月/㎡', '120-140元/月/㎡'],
        ['不限', '<5000元', '5000-1万元', '1-2万元', '2-5万元']
    ];
    $('._price ._price_1').on('click', function() {
        $(this).addClass('active').siblings('._price .list_change').removeClass('active')
        $('._price .right').get(0).innerHTML = ''
        for (var i = 0; i < __price[$(this).index()].length; i++) {
            $('._price .right').get(0).innerHTML += `
                <p class="list_change _price_2">${__price[$(this).index()][i]}
                        <span class="checkbox"></span>
                </p>`;
        };
        $('._price ._price_2').on('click', function() {
            $(this).toggleClass('active');
            $('._price .checkbox').eq($(this).index()).html(`
                <span class="mui-icon mui-icon-checkmarkempty true"></span> `);
        });
    });
    $('._price .price_all').click(() => {
        $('.hide_option').hide();
        $('.tab_option').eq(1).removeClass('active');
    });
    $('._price .price_true').click(() => {
        $('.tab_option').eq(1).addClass('active');
        $('.hide_option').hide();
        if ($('._price .right .active').length == 0) {
            $('.tab_option').eq(1).removeClass('active');
        };
    });
    $('._type .price_all').click(() => {
        $('.hide_option').hide();
        $('.tab_option').eq(2).removeClass('active');
    });
    $('._type .price_true').click(() => {
        $('.tab_option').eq(2).addClass('active');
        $('.hide_option').hide();
        if ($('._type .active').length == 0) {
            $('.tab_option').eq(2).removeClass('active');
        };
    });
    $('._age .price_all').click(() => {
        $('.hide_option').hide();
        $('.tab_option').eq(3).removeClass('active');
    });
    $('._age .price_true').click(() => {
        $('.tab_option').eq(3).addClass('active');
        $('.hide_option').hide();
        if ($('._age .active').length == 0) {
            $('.tab_option').eq(3).removeClass('active');
        };
    });
    $('._price ._price_2').on('click', function() {
        $(this).toggleClass('active');
        $('._price .checkbox').eq($(this).index()).html(`
                <span class="mui-icon mui-icon-checkmarkempty true"></span> `);
    });
    $('._change .list_change').on('click', function() {
        $(this).addClass('active').siblings('._change .list_change').removeClass('active');
        $('.tab_option').eq(4).addClass('active');
        $('.hide_option').hide();
    });
    $('._type .list_change').on('click', function() {
        $(this).toggleClass('active');
        $('._type .checkbox').eq($(this).index()).html(`
                <span class="mui-icon mui-icon-checkmarkempty true"></span> `);
    });
    $('._type .true').on('click', function() {
        $('.tab_option').eq(2).addClass('active');
        $('.hide_option').hide();
    });
    $('._age .list_change').on('click', function() {
        $(this).toggleClass('active');
        $('._age .checkbox').eq($(this).index()).html(`
                <span class="mui-icon mui-icon-checkmarkempty true"></span> `);
    });
    $('._age .true').on('click', function() {
        $('.tab_option').eq(3).addClass('active');
        $('.hide_option').hide();
    });
    $('.off_click').off('click');
    var a = 0;
    window.onload = function() {
        tab_list(a);
    };

    function tab_list(i) {
        $('.alert').show();
        if (i <
            4) {
            $.getJSON('http://localhost:3000/list?num=' + i, function(data) {
                for (var i = 0; i < data.length; i++) {
                    $('.lists').get(0).innerHTML += ` <li class="list">
                    <a href="">
                        <div class="list_img fl"><img src="${data[i].img}"></div>
                        <div class="list_content fl">
                            <p class="list_name">${data[i].name}</p>
                            <p class="present">${data[i].present}</p>
                            <p class="list_nice">
                                <span class="bg_blue nice">${data[i].nice}</span>
                            </p>
                            <p class="list_price">
                                <span class="clr_red">${data[i].price1}</span>
                                <span class="clr_gray">${data[i].price2}</span>
                            </p>
                        </div>
                    </a>
            </li>`
                };
                setTimeout(() => {
                    $('.alert').hide();
                }, 300);
            });
        } else {
            $('.alert').text('到底了...');
            setTimeout(() => {
                $('.alert').hide();
            }, 300);
        };
    };
    setTimeout(() => {
        window.onscroll = function() {
            if ($(window).scrollTop() + $(window).height() + 50 > $(document).height()) {
                a++;
                tab_list(a);
            };
        };
    }, 1000);
    var num_scroll = $(".nav").offset().top;
    window.addEventListener("scroll", function() {
        if ($(this).scrollTop() > num_scroll) {
            $('.nav').addClass('flexd');
        } else if ($(this).scrollTop() <
            num_scroll) {
            $('.nav').removeClass('flexd');
        };
    });
</script>

</html>